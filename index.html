<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TiffyAI Purchase</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .purchase-form { display: flex; flex-direction: column; gap: 10px; }
        .quantity-input { padding: 5px; width: 100px; }
        .invoice-popup { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .popup-content { background: white; margin: 50px auto; padding: 20px; width: 400px; border-radius: 8px; }
        .payment-options { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; }
        .payment-option { display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .payment-option.selected { border-color: #007bff; background: #f0f8ff; }
        .proceed-btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px; }
        .proceed-btn:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>
    <h1>Buy TiffyAI Tokens</h1>
    <div class="purchase-form">
        <label for="quantity">How many TiffyAI tokens do you want to buy?</label>
        <input type="number" id="quantity" class="quantity-input" min="1" value="1">
        <button onclick="generateInvoice()">Generate Invoice</button>
    </div>

    <div id="invoicePopup" class="invoice-popup">
        <div class="popup-content">
            <h2>Invoice</h2>
            <p id="invoiceDetails"></p>
            <div class="payment-options">
                <div class="payment-option" onclick="selectPayment('BNB')">
                    <input type="radio" id="bnb" name="payment" value="BNB" checked>
                    <label for="bnb">BNB (Binance Smart Chain)</label>
                </div>
                <div class="payment-option" onclick="selectPayment('ETH')">
                    <input type="radio" id="eth" name="payment" value="ETH">
                    <label for="eth">ETH (Ethereum)</label>
                </div>
                <div class="payment-option" onclick="selectPayment('USDT')">
                    <input type="radio" id="usdt" name="payment" value="USDT">
                    <label for="usdt">USDT (ERC-20)</label>
                </div>
            </div>
            <button id="proceedBtn" class="proceed-btn" onclick="proceedToPayment()" disabled>Proceed to Payment</button>
            <button onclick="closePopup()">Cancel</button>
        </div>
    </div>

    <script>
        let selectedQuantity = 0;
        let selectedPayment = 'BNB';

        function generateInvoice() {
            selectedQuantity = parseInt(document.getElementById('quantity').value) || 1;
            if (selectedQuantity < 1) {
                alert('Please select a valid quantity.');
                return;
            }
            // Assume price per token is 0.01 BNB or equivalent; adjust as needed
            const pricePerToken = 0.01;
            const totalAmount = selectedQuantity * pricePerToken;
            document.getElementById('invoiceDetails').innerHTML = `
                <p>Quantity: ${selectedQuantity} TiffyAI Tokens</p>
                <p>Price per Token: ${pricePerToken} BNB</p>
                <p>Total: ${totalAmount} BNB</p>
                <p>Payment Method: Select below</p>
            `;
            document.getElementById('proceedBtn').disabled = true;
            document.getElementById('invoicePopup').style.display = 'block';
            selectPayment('BNB'); // Default to BNB
        }

        function selectPayment(method) {
            selectedPayment = method;
            document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
            event.target.closest('.payment-option').classList.add('selected');
            document.querySelector(`input[value="${method}"]`).checked = true;
            document.getElementById('proceedBtn').disabled = false;
        }

        function closePopup() {
            document.getElementById('invoicePopup').style.display = 'none';
        }

        function proceedToPayment() {
            if (selectedQuantity < 1) return;

            // Simulate payment initiation (in real app, integrate with Web3/wallet like MetaMask or WalletConnect)
            // For demo: Alert with details; replace with actual payment flow
            const walletAddress = prompt('Enter your wallet address for payment:'); // In real: get from connected wallet
            if (!walletAddress) return;

            alert(`Initiating payment of ${selectedQuantity * 0.01} ${selectedPayment} to contract...\nWallet: ${walletAddress}\n\nAfter confirmation, redirecting...`);

            // Simulate payment success and redirect
            // In real: Listen for transaction confirmation, then redirect
            setTimeout(() => {
                // Backend will handle token send AFTER redirect (e.g., via route handler on /Blue-Key-Claim checking payment)
                window.location.href = '/Blue-Key-Claim?quantity=' + selectedQuantity + '&payment=' + selectedPayment + '&wallet=' + encodeURIComponent(walletAddress);
            }, 2000);
        }

        // Close popup on outside click
        window.onclick = function(event) {
            const popup = document.getElementById('invoicePopup');
            if (event.target === popup) {
                closePopup();
            }
        }
    </script>
</body>
</html>
